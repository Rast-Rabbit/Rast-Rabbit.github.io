<header class="header" id="site-header">
  <div class="header-inner">

    <!-- å·¦ç«¯: ãƒ­ã‚´ï¼ˆPC ã®ã¿è¡¨ç¤ºï¼‰ -->
    <a class="header-logo" href="/">
      <span class="header-logo-icon" aria-hidden="true">âŒ‚</span>Rabbit<span class="header-logo-amp">&amp;</span><span class="header-logo-r">R</span>astdungeon
    </a>

    <!-- ãƒŠãƒ“ï¼ˆPC ã®ã¿è¡¨ç¤ºï¼‰ -->
    <nav class="header-nav" aria-label="ã‚µã‚¤ãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³">
      <a href="/replays/"       class="header-nav-link{% if page.nav == 'replays' %}       is-active{% endif %}">Replay</a>
      <a href="/session-logs/"  class="header-nav-link{% if page.nav == 'session-logs' %}  is-active{% endif %}">Session Log</a>
      <a href="/external/"      class="header-nav-link{% if page.nav == 'external' %}      is-active{% endif %}">External</a>
    </nav>

    <!-- å³ç«¯: ãƒ†ãƒ¼ãƒï¼‹å¤‰å½¢ãƒœã‚¿ãƒ³åˆ†ã®ã‚¹ãƒšãƒ¼ã‚µãƒ¼ï¼ˆå›ºå®šãƒœã‚¿ãƒ³ã¨ã®é‡ãªã‚Šé˜²æ­¢ï¼‰ -->
    <div class="header-controls">
      <div class="header-morph-spacer" aria-hidden="true"></div>
    </div>

  </div>
</header>

<!-- ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ï¼ˆå¸¸æ™‚è¡¨ç¤ºãƒ»å³ä¸Šå›ºå®šï¼‰ -->
<button class="theme-btn" id="theme-btn" aria-label="ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ">ğŸŒ™</button>

<!-- å¤‰å½¢ãƒœã‚¿ãƒ³ï¼ˆPC: ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã® Ã— ã¨ã€ç•³ã‚“ã å¾Œã® â‰¡ ã‚’ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰ï¼‰ -->
<button class="header-morph-btn" id="header-morph-btn" aria-label="ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’éš ã™">
  <span class="morph-icon morph-icon--x"   aria-hidden="true">Ã—</span>
  <span class="morph-icon morph-icon--ham" aria-hidden="true">â‰¡</span>
</button>

<!-- ãƒ¢ãƒã‚¤ãƒ«: ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚° â‰¡ ãƒœã‚¿ãƒ³ï¼ˆPC ã§ã¯éè¡¨ç¤ºï¼‰ -->
<button class="mobile-ham-btn" id="mobile-ham-btn" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã">â‰¡</button>

<!-- ãƒ¢ãƒã‚¤ãƒ«: ãƒãƒƒã‚¯ãƒ‰ãƒ­ãƒƒãƒ— -->
<div class="mobile-backdrop" id="mobile-backdrop" aria-hidden="true"></div>

<!-- ãƒ¢ãƒã‚¤ãƒ«: å³ãƒ‰ãƒ­ãƒ¯ãƒ¼ -->
<nav class="mobile-drawer" id="mobile-drawer" aria-label="ãƒ¢ãƒã‚¤ãƒ«ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³">
  <div class="mobile-drawer-header">
    <span class="mobile-drawer-title">Rabbit&amp;&nbsp;<span class="drawer-logo-r">R</span>astdungeon</span>
    <button class="mobile-drawer-close" id="mobile-drawer-close" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹">âœ•</button>
  </div>
  <a href="/"              class="mobile-drawer-link{% if page.nav == 'home' %}            is-active{% endif %}">âŒ‚ Home</a>
  <a href="/replays/"       class="mobile-drawer-link{% if page.nav == 'replays' %}       is-active{% endif %}">Replay</a>
  <a href="/session-logs/"  class="mobile-drawer-link{% if page.nav == 'session-logs' %}  is-active{% endif %}">Session Log</a>
  <a href="/external/"      class="mobile-drawer-link{% if page.nav == 'external' %}      is-active{% endif %}">External</a>
</nav>

<script>
(function () {
  /* ãƒ†ãƒ¼ãƒã‚’ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãªã—ã§å¾©å…ƒï¼ˆDOMContentLoaded å‰ã«å®Ÿè¡Œï¼‰ */
  var saved = localStorage.getItem('site-theme');
  if (saved === 'light') document.documentElement.classList.add('light');

  document.addEventListener('DOMContentLoaded', function () {

    /* === PC: ãƒ˜ãƒƒãƒ€ãƒ¼æŠ˜ã‚Šç•³ã¿ === */
    var siteHeader = document.getElementById('site-header');
    var morphBtn   = document.getElementById('header-morph-btn');
    var isHidden   = false;

    morphBtn.addEventListener('click', function () {
      isHidden = !isHidden;
      siteHeader.classList.toggle('is-hidden', isHidden);
      morphBtn.classList.toggle('is-gone', isHidden);
      morphBtn.setAttribute('aria-label', isHidden ? 'ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¡¨ç¤º' : 'ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’éš ã™');
    });

    /* === ãƒ¢ãƒã‚¤ãƒ«: ãƒ‰ãƒ­ãƒ¯ãƒ¼ === */
    var mobileHam  = document.getElementById('mobile-ham-btn');
    var backdrop   = document.getElementById('mobile-backdrop');
    var drawer     = document.getElementById('mobile-drawer');
    var closeBtn   = document.getElementById('mobile-drawer-close');

    function openDrawer() {
      drawer.classList.add('is-open');
      backdrop.classList.add('is-open');
      backdrop.removeAttribute('aria-hidden');
      mobileHam.setAttribute('aria-label', 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹');
    }
    function closeDrawer() {
      drawer.classList.remove('is-open');
      backdrop.classList.remove('is-open');
      backdrop.setAttribute('aria-hidden', 'true');
      mobileHam.setAttribute('aria-label', 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã');
    }

    mobileHam.addEventListener('click', function () {
      drawer.classList.contains('is-open') ? closeDrawer() : openDrawer();
    });
    backdrop.addEventListener('click', closeDrawer);
    closeBtn.addEventListener('click', closeDrawer);

    /* === ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ === */
    var themeBtn = document.getElementById('theme-btn');
    var isLight  = document.documentElement.classList.contains('light');
    if (isLight) themeBtn.textContent = 'â˜€';

    themeBtn.addEventListener('click', function () {
      isLight = !isLight;
      document.documentElement.classList.toggle('light', isLight);
      themeBtn.textContent = isLight ? 'â˜€' : 'ğŸŒ™';
      localStorage.setItem('site-theme', isLight ? 'light' : 'dark');

      /* ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ã‚‚å«ã‚€å…¨ iframe ã« postMessage */
      document.querySelectorAll('iframe').forEach(function (f) {
        try { f.contentWindow.postMessage({ theme: isLight ? 'light' : 'dark' }, '*'); } catch (e) {}
      });
    });

  });
})();
</script>
